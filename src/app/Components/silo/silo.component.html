<div class="flex flex-col gap-2">
  <div>
    <h1 class="font-bold text-xl uppercase">
      <i class="fa-solid fa-user"></i> Bienvenue: {{ user.name }}
    </h1>
  </div>
  <div
    class="flex flex-row justify-between items-center gap-2 p-4 bg-slate-300"
  >
    <h1 class="text-xl font-semibold text-dark-purple">
      Section pour gére les silos
    </h1>
    <button
      type="submit"
      class="p-2 bg-dark-purple text-white text-lg rounded-md"
      (click)="FormVisible()"
    >
      Add Silo
    </button>
  </div>
  <div
    class="flex lg:flex-row flex-col items-center justify-between px-2 bg-slate-200 w-full"
  >
    <div
      class="flex lg:flex-row flex-col justify-between items-center gap-2 p-3 w-full"
    >
      <!-- <select
        name="statut"
        class="p-2 rounded-sm w-40 text-center"
      >
        <option value="">Choisissez</option>
        <option value="impaye">Impayé</option>
        <option value="paye">Payé</option>
      </select> -->
      <input
        class="p-2 rounded-sm w-[80%] text-center"
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Rechercher..."
        (input)="performSearch()"
      />

    </div>
  </div>
  <div>
    <div class="mt-8 overflow-x-auto bg-white p-4 shadow-md">
      <table class="min-w-full bg-gray-50">
        <thead class="bg-gray-200">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              N° silo
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Produit
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Stock initial
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Entre
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Consommation Auto
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Stock Final
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Date Validation
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Statut
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="overflow-y-auto">
          <tr
            class="bg-gray-50 hover:bg-gray-200"
            *ngFor="let silo of silos; let i = index"
          >
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.silo }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.produit }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.stocki }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.entre }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.consumation }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.stockf }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.datevalidation }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              {{ silo.statut }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 border-b">
              <!-- Bouton Modifier -->
              <button
                type="submit"
                class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 flex items-center"
                (click)="toggleFormUpdate()"
                (click)="getElementObj(silo.id)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    d="M15.232 2.232a2.5 2.5 0 013.536 3.536l-10 10a2.5 2.5 0 01-1.06.662l-4 1a1 1 0 01-1.265-1.265l1-4a2.5 2.5 0 01.662-1.06l10-10zM12.5 3.5L16.5 7.5 15 9 11 5l1.5-1.5zM5 12l3 3-1.5 1.5-2.5-.5-.5-2.5L5 12z"
                  />
                </svg>
              </button>

              <!-- Bouton Supprimer -->
              <button
                type="submit"
                class="bg-red-500 text-white p-2 rounded hover:bg-red-600 flex items-center"
                (click)="deleteSilo(silo.id)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M9 2a1 1 0 00-1 1v1H4.5a1 1 0 00-.99.858L3 7v1a1 1 0 001 1h12a1 1 0 001-1V7l-.51-2.142A1 1 0 0015.5 4H11V3a1 1 0 00-1-1H9zm3 3V3H8v2h4zm-7.5 4a.5.5 0 00-.5.5V15a2 2 0 002 2h8a2 2 0 002-2V9.5a.5.5 0 00-.5-.5H4.5zM7 11a1 1 0 112 0v4a1 1 0 11-2 0v-4zm6 0a1 1 0 112 0v4a1 1 0 11-2 0v-4z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!--le form pour creer les silos-->
  <div
    *ngIf="isFormVisible"
    class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center z-10"
  >
    <form class="bg-white p-6 rounded-lg lg:w-1/3 w-72 text-center">
      <h2 class="text-lg font-bold">Ajouter un Silo</h2>
      <input
        type="text"
        placeholder="N° Silo"
        class="p-2 rounded-md w-full mt-2"
        name="numsilo"
        required
        [(ngModel)]="numsilo"
      />
      <input
        type="text"
        placeholder="Produit"
        class="p-2 rounded-md w-full mt-2"
        name="produit"
        required
        [(ngModel)]="produit"
      />
      <input
        type="number"
        placeholder="Stock initial"
        class="p-2 rounded-md w-full mt-2"
        name="stockI"
        required
        [(ngModel)]="stocki"
      />
      <input
        type="number"
        placeholder="Entre"
        class="p-2 rounded-md w-full mt-2"
        name="entre"
        required
        [(ngModel)]="entre"
      />
      <input
        type="number"
        placeholder="Consommation Auto"
        class="p-2 rounded-md w-full mt-2"
        name="consommation"
        required
        [(ngModel)]="consumation"
      />
      <div class="flex justify-center mt-4">
        <button
          type="submit"
          class="bg-dark-purple text-white p-2 rounded-md"
          (click)="postSilo()"
        >
          <i class="fa-solid fa-floppy-disk"></i> Enregistrer
        </button>
        <button
          type="button"
          class="bg-gray-400 text-white p-2 rounded-md ml-2"
          (click)="FormVisible()"
        >
          <i class="fa-solid fa-xmark"></i> Annuler
        </button>
      </div>
    </form>
  </div>
  <!--le form pour modifier les silos-->
  <div
    *ngIf="isFormVisibleUpdate"
    class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center z-10"
  >
    <form class="bg-white p-6 rounded-lg lg:w-1/3 w-72 text-center">
      <h2 class="text-lg font-bold">Modifier un Silo</h2>
      <input
        type="text"
        placeholder="N° Silo"
        class="p-2 rounded-md w-full mt-2"
        name="numsilo"
        required
        [(ngModel)]="numsilo"
        [value]="obj.numsilo"
      />
      <input
        type="text"
        placeholder="Produit"
        class="p-2 rounded-md w-full mt-2"
        name="produit"
        required
        [(ngModel)]="produit"
        [value]="obj.produit"
      />
      <input
        type="number"
        placeholder="Stock initial"
        class="p-2 rounded-md w-full mt-2"
        name="stocki"
        required
        [(ngModel)]="stocki"
        [value]="obj.stocki"
      />
      <input
        type="number"
        placeholder="Entre"
        class="p-2 rounded-md w-full mt-2"
        name="entre"
        required
        [(ngModel)]="entre"
        [value]="obj.entre"
      />
      <input
        type="number"
        placeholder="Consommation Auto"
        class="p-2 rounded-md w-full mt-2"
        name="consumation"
        required
        [(ngModel)]="consumation"
        [value]="obj.consumation"
      />
      <div class="flex justify-center mt-4">
        <button
          type="submit"
          class="bg-dark-purple text-white p-2 rounded-md"
          (click)="updateSilo(obj.id)"
        >
          <i class="fa-solid fa-floppy-disk"></i> Modifier
        </button>
        <button
          type="button"
          class="bg-gray-400 text-white p-2 rounded-md ml-2"
          (click)="toggleFormUpdate()"
        >
          <i class="fa-solid fa-xmark"></i> Annuler
        </button>
      </div>
    </form>
  </div>
</div>
